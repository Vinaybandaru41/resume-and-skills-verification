<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Decentralized Resume Verification</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #e6f0ff;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h2, h3 {
      text-align: center;
      color: #003366;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    input {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    button {
      width: 100%;
      background-color: #003366;
      color: white;
      padding: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 10px;
    }

    button:hover {
      background-color: #0055aa;
    }

    #walletAddress {
      text-align: center;
      margin-bottom: 20px;
      font-weight: bold;
    }

    .resume-card {
      background: #f5faff;
      border: 1px solid #cce0ff;
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
    }

    hr {
      border: none;
      height: 1px;
      background-color: #ccc;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Decentralized Resume & Skill Verification</h2>
    
    <button onclick="connectWallet()">Connect Wallet</button>
    <p id="walletAddress"></p>

    <h3>Submit Resume</h3>
    <input id="name" placeholder="Name" />
    <input id="email" placeholder="Email" />
    <input id="qualification" placeholder="Qualification" />
    <input id="skills" placeholder="Skills (comma separated)" />
    <input id="experience" placeholder="Experience" />
    <button onclick="submitResume()">Submit Resume</button>

    <h3>My Resumes</h3>
    <button onclick="fetchMyResumes()">Load Resumes</button>
    <div id="resumeList"></div>
  </div>

  <script>
    const contractAddress = '0xe58eB4F0550b8CAb4Ac996f6a9D8e4F5556fCaCa'; // Replace with your address
    const contractABI = [[
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "resumeId",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			}
		],
		"name": "ResumeSubmitted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "resumeId",
				"type": "uint256"
			}
		],
		"name": "ResumeVerified",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_qualification",
				"type": "string"
			},
			{
				"internalType": "string[]",
				"name": "_skills",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "_experience",
				"type": "string"
			}
		],
		"name": "submitResume",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "fallback"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_resumeId",
				"type": "uint256"
			}
		],
		"name": "verifyResume",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "receive"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getMyResumeIds",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_resumeId",
				"type": "uint256"
			}
		],
		"name": "getResume",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "qualification",
				"type": "string"
			},
			{
				"internalType": "string[]",
				"name": "skills",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "experience",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "verified",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "submittedBy",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "resumeCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "resumes",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "qualification",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "experience",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "verified",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "submittedBy",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "resumesByUser",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]];

    let contract;
    let signer;

    async function connectWallet() {
      if (window.ethereum) {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        const address = await signer.getAddress();
        document.getElementById("walletAddress").innerText = "Connected: " + address;
        contract = new ethers.Contract(contractAddress, contractABI, signer);
      } else {
        alert("MetaMask not found. Please install it.");
      }
    }

    async function submitResume() {
      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      const qualification = document.getElementById("qualification").value;
      const skillsInput = document.getElementById("skills").value;
      const experience = document.getElementById("experience").value;

      const skills = skillsInput.split(',').map(skill => skill.trim());

      try {
        const tx = await contract.submitResume(name, email, qualification, skills, experience);
        await tx.wait();
        alert("Resume submitted!");
      } catch (err) {
        alert("Error: " + err.message);
      }
    }

    async function fetchMyResumes() {
      try {
        const ids = await contract.getMyResumeIds();
        const resumeList = document.getElementById("resumeList");
        resumeList.innerHTML = "";

        for (let i = 0; i < ids.length; i++) {
          const resume = await contract.getResume(ids[i]);
          const div = document.createElement("div");
          div.className = "resume-card";
          div.innerHTML = `
            <p><strong>ID:</strong> ${ids[i]}</p>
            <p><strong>Name:</strong> ${resume[0]}</p>
            <p><strong>Email:</strong> ${resume[1]}</p>
            <p><strong>Qualification:</strong> ${resume[2]}</p>
            <p><strong>Skills:</strong> ${resume[3].join(", ")}</p>
            <p><strong>Experience:</strong> ${resume[4]}</p>
            <p><strong>Verified:</strong> ${resume[5] ? "✅ Yes" : "❌ No"}</p>
            <p><strong>Submitted By:</strong> ${resume[6]}</p>
          `;
          resumeList.appendChild(div);
        }
      } catch (err) {
        alert("Error fetching resumes: " + err.message);
      }
    }
  </script>
</body>
</html>
